{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["//middleware.ts\nimport { NextResponse } from 'next/server';\nimport { withAuth } from 'next-auth/middleware';\n\nexport default withAuth(\n  async function middleware(req) {\n    console.log(\"Request path:\", req.nextUrl.pathname);\n\n    // تجاهل طلبات API والملفات الثابتة\n    if (\n      req.nextUrl.pathname.startsWith('/api') ||\n      req.nextUrl.pathname.startsWith('/_next') ||\n      req.nextUrl.pathname.includes('.')\n    ) {\n      console.log(\"Request is for API or static file, continuing...\");\n      return NextResponse.next();\n    }\n\n    // التحقق من الحاجة للإعداد فقط للمسارات غير العامة\n    if (!['/setup', '/login', '/register'].includes(req.nextUrl.pathname)) {\n      try {\n        console.log(\"Checking setup status...\");\n        const setupCheck = await fetch(\n          new URL('/api/auth/setup', req.nextUrl.origin)\n        );\n        const { setupRequired } = await setupCheck.json();\n        console.log(\"Setup required:\", setupRequired);\n\n        if (setupRequired && req.nextUrl.pathname !== '/setup') {\n          console.log(\"Redirecting to /setup...\");\n          return NextResponse.redirect(new URL('/setup', req.nextUrl.origin));\n        }\n      } catch (error) {\n        console.error('Setup check failed:', error);\n      }\n    }\n\n    // لا تقم بإعادة التوجيه إلى صفحة login حتى لو كان هناك مستخدم ADMIN\n    if (req.nextUrl.pathname === '/setup') {\n      console.log(\"Allowing access to /setup...\");\n      return NextResponse.next(); // إبقاء المستخدم في صفحة setup\n    }\n\n    console.log(\"Proceeding to next page...\");\n    return NextResponse.next();\n  },\n  {\n    callbacks: {\n      authorized: ({ token }) => !!token,\n    },\n    pages: {\n      signIn: '/login',\n      error: '/login',\n    },\n  }\n);\n\nexport const config = {\n  matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)'],\n};\n"],"names":[],"mappings":"AAAA,eAAe;;;;;AACf;AAAA;AACA;;;uCAEe,CAAA,GAAA,kJAAA,CAAA,WAAQ,AAAD,EACpB,eAAe,WAAW,GAAG;IAC3B,QAAQ,GAAG,CAAC,iBAAiB,IAAI,OAAO,CAAC,QAAQ;IAEjD,mCAAmC;IACnC,IACE,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,WAChC,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,aAChC,IAAI,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAC9B;QACA,QAAQ,GAAG,CAAC;QACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,mDAAmD;IACnD,IAAI,CAAC;QAAC;QAAU;QAAU;KAAY,CAAC,QAAQ,CAAC,IAAI,OAAO,CAAC,QAAQ,GAAG;QACrE,IAAI;YACF,QAAQ,GAAG,CAAC;YACZ,MAAM,aAAa,MAAM,MACvB,IAAI,IAAI,mBAAmB,IAAI,OAAO,CAAC,MAAM;YAE/C,MAAM,EAAE,aAAa,EAAE,GAAG,MAAM,WAAW,IAAI;YAC/C,QAAQ,GAAG,CAAC,mBAAmB;YAE/B,IAAI,iBAAiB,IAAI,OAAO,CAAC,QAAQ,KAAK,UAAU;gBACtD,QAAQ,GAAG,CAAC;gBACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,OAAO,CAAC,MAAM;YACnE;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,uBAAuB;QACvC;IACF;IAEA,oEAAoE;IACpE,IAAI,IAAI,OAAO,CAAC,QAAQ,KAAK,UAAU;QACrC,QAAQ,GAAG,CAAC;QACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,IAAI,+BAA+B;IAC7D;IAEA,QAAQ,GAAG,CAAC;IACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B,GACA;IACE,WAAW;QACT,YAAY,CAAC,EAAE,KAAK,EAAE,GAAK,CAAC,CAAC;IAC/B;IACA,OAAO;QACL,QAAQ;QACR,OAAO;IACT;AACF;AAGK,MAAM,SAAS;IACpB,SAAS;QAAC;KAAoD;AAChE"}}]
}