(()=>{var e={};e.id=490,e.ids=[490],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47349:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>y,serverHooks:()=>g,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>m});var a=r(96559),n=r(48088),o=r(37719),i=r(94705),u=r(71682),c=r(32190),l=r(70762);let p=l.z.object({name:l.z.string().min(2,"Name must be at least 2 characters"),email:l.z.string().email("Invalid email address"),password:l.z.string().min(8,"Password must be at least 8 characters")});async function d(){try{console.log("Checking if admin exists...");let e=await u.Ay.user.count({where:{role:"ADMIN"}});return console.log("Admin exists:",e>0),c.NextResponse.json({setupRequired:0===e})}catch(e){return console.error("Setup check error:",e),c.NextResponse.json({error:"Failed to check setup status"},{status:500})}}async function m(e){try{if(await u.Ay.user.count({where:{role:"ADMIN"}})>0)return c.NextResponse.json({error:"Setup has already been completed"},{status:400});let t=await e.json(),r=p.safeParse(t);if(!r.success)return c.NextResponse.json({error:"Invalid input",details:r.error.flatten()},{status:400});return await (0,i.y6)(r.data),c.NextResponse.json({success:!0,message:"Root admin created successfully"},{status:201})}catch(e){if(console.error("Root admin creation error:",e),e instanceof Error&&"Root admin already exists"===e.message)return c.NextResponse.json({error:"Root admin already exists"},{status:409});return c.NextResponse.json({error:"Failed to create root admin"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/setup/route",pathname:"/api/auth/setup",filename:"route",bundlePath:"app/api/auth/setup/route"},resolvedPagePath:"C:\\Users\\pc\\Desktop\\fixed-blog - Copy\\src\\app\\api\\auth\\setup\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:h,serverHooks:g}=y;function w(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:h})}},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71682:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>n,jE:()=>a});let s=new(r(96330)).PrismaClient;async function a(){console.log("Fetching categories from database...");let e=await s.category.findMany();return console.log("Fetched categories:",e),e}let n=s},72609:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{describeHasCheckingStringProperty:function(){return a},describeStringPropertyAccess:function(){return s},wellKnownProperties:function(){return n}});let r=/^[A-Za-z_$][A-Za-z0-9_$]*$/;function s(e,t){return r.test(t)?"`"+e+"."+t+"`":"`"+e+"["+JSON.stringify(t)+"]`"}function a(e,t){let r=JSON.stringify(t);return"`Reflect.has("+e+", "+r+")`, `"+r+" in "+e+"`, or similar"}let n=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","valueOf","toLocaleString","then","catch","finally","status","displayName","toJSON","$$typeof","__esModule"])},78335:()=>{},94705:(e,t,r)=>{"use strict";r.d(t,{DY:()=>n,y6:()=>o});var s=r(71682),a=r(85663);async function n(e){try{let t=await a.Ay.hash(e.password,10);return await s.Ay.user.create({data:{name:e.name,email:e.email,password:t}})}catch(e){if(e instanceof Error&&e.message.includes("Unique constraint failed on the fields: (`email`)"))throw Error("User already exists");throw e}}async function o(e){if(await s.Ay.user.findFirst({where:{role:"ADMIN"}}))throw Error("Root admin already exists");let t=await a.Ay.hash(e.password,10);return await s.Ay.user.create({data:{name:e.name,email:e.email,password:t,role:"ADMIN"}})}},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,368,580,762],()=>r(47349));module.exports=s})();